function Bg(a){function b(a){e=a,d.removeClass("bg-current"),$(".bg-"+a).addClass("bg-current")}var c=a,d=c.find("li"),e=0;return{setBg:function(a){b(a)}}}Handlebars.registerHelper("getAvailableValues",function(a,b,c){for(var d="",e=0;e<a.length;e++){var f=a[e];if(f.attributes.hasOwnProperty(b)){var g=f.attributes[b];d.indexOf(g)<0&&(d+=c.fn(g))}}return d}),Handlebars.registerHelper("getCorrespondingItems",function(a,b,c){for(var d="",e=0;e<a.length;e++){var f=a[e],g=_.filter(f,b);g===!0&&(d+=c.fn(f.name))}return d}),Handlebars.registerHelper("ifEmpty",function(a,b){return _.isEmpty(a)?b.fn(a):void 0}),Handlebars.registerHelper("ifNotEmpty",function(a,b){return _.isEmpty(a)?void 0:b.fn(a)}),Backbone.Transitions={},Backbone.Transitions.transit=function(a,b){var c=this;if(b=b||null,c.currView){c.currView.$el.removeClass("view-current");var d;c.currView.$el.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){_.delay(function(){c.render(a,b),d=!0},200)}),Modernizr.csstransitions||c.currView.$el.trigger("transitionend")}else c.render(a,b);c.currView=a},Backbone.Transitions.render=function(a,b){a.render(b),_.delay(function(){a.$el.addClass("view-current")},20)},window.Bg=new Bg($(".bg"));var spinner=$(".loader").spin({lines:13,length:10,width:2,radius:15,trail:10,speed:2}),userSelection=Backbone.Model.extend({}),Strains=Backbone.Collection.extend({url:"assets/data/strains.json"}),viewHome=Backbone.View.extend({el:".view",initialize:function(){},render:function(){var a=this,b=Handlebars.templates.home();a.$el.html(b),Bg.setBg("home")}}),viewDoctors=Backbone.View.extend({el:".view",initialize:function(){},render:function(){var a=this,b=Handlebars.templates.doctors();a.$el.html(b),Bg.setBg("doctors")}}),viewPatients=Backbone.View.extend({el:".view",initialize:function(){},render:function(){var a=this,b=Handlebars.templates.patients();a.$el.html(b),Bg.setBg("patients")}}),viewBrowse=Backbone.View.extend({el:".view",cat:["condition","ailment","ingestion","effect"],currentCat:"",pos:function(){var a=_.indexOf(this.cat,this.currentCat);return a},initialize:function(){var a=this;this.listenTo(this.model,"change",function(){Backbone.Transitions.transit(a,a.currentCat)})},render:function(a){var b=this;this.currentCat=a;var c=new Strains;spinner.show(),c.fetch({success:function(c){Bg.setBg(a),spinner.spin(!1).hide(600);var d;if("result"==a){var e=b.model.attributes,f=[],g=[];console.log("criteria",e);for(var h=0;h<c.models.length;h++)f.push(c.models[h].attributes);g=f,d=Handlebars.templates.result({items:g})}else d=Handlebars.templates.browse({data:c.models,category:a,criteria:b.model.attributes});b.$el.html(d)}})},goTo:function(a){var b,c=this.cat.length-1,d=this.pos();d!=a&&(b=a>d?d==c?this.cat[0]:this.cat[d+1]:0==d?this.cat[c]:this.cat[d-1],router.navigate("#/browse/"+b,{}))},prev:function(){this.goTo(this.pos()-1)},next:function(){this.goTo(this.pos()+1)},events:{"click .select":"saveUserSelection","click .reset":"reset","click .next":"next"},saveUserSelection:function(a){var b=$(a.currentTarget).text().trim();this.model.set(this.currentCat,b);var c=_.keys(this.model.attributes);c.length===this.cat.length?(console.log("result",this.model.attributes),router.navigate("#/browse/result",{})):this.next()},reset:function(){this.model.clear()}}),viewDetail=Backbone.View.extend({el:".view",render:function(a){var b=this,c=new Strains;spinner.show(),c.fetch({success:function(c){Bg.setBg("detail"),spinner.spin(!1).hide(600);var d={id:a},e=_.filter(c.models,d),f=Handlebars.templates.detail({item:e[0].attributes});b.$el.html(f)}})}}),EditUser=Backbone.View.extend({el:".page",render:function(){var a=$("#edit-user-form").html(),b=Handlebars.template(a);this.$el.html(b({}))},events:{},SaveUser:function(a){var b=$(a.currentTarget).serializeObject(),c=new User;return c.save(b,{success:function(a){router.navigate("",{trigger:!0})}}),!1}}),Router=Backbone.Router.extend({execute:function(a,b){},routes:{"browse/:query":"browse",browse:"browse","detail/:id":"detail",patients:"patients",doctors:"doctors",home:"home","*other":"home"}}),userSelection=new userSelection,viewHome=new viewHome,viewPatients=new viewPatients,viewDoctors=new viewDoctors,viewBrowse=new viewBrowse({model:userSelection}),viewDetail=new viewDetail,router=new Router;router.on("route:home",function(){Backbone.Transitions.transit(viewHome),router.navigate("#/home",{})}).on("route:patients",function(){Backbone.Transitions.transit(viewPatients)}).on("route:doctors",function(){Backbone.Transitions.transit(viewDoctors)}).on("route:browse",function(a){null===a?a=viewBrowse.cat[0]:"result"==a?console.log("reached result"):_.contains(viewBrowse.cat,a)||(a=viewBrowse.cat[0]),router.navigate("#/browse/"+a,{}),Backbone.Transitions.transit(viewBrowse,a)}).on("route:detail",function(a){Backbone.Transitions.transit(viewDetail,a)}),Backbone.history.start();